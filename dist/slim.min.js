function E(t){let e=new URLSearchParams,n=t,c=[];for(;n;)c.unshift(n),n=n.parentElement;for(let a of c){let u=a.getAttribute("s-query");u&&new URLSearchParams(u).forEach((p,d)=>e.set(d,p))}return e}function S(t,e){if(e.toString()==="")return t;let n=new URL(t,location.origin);return e.forEach((c,a)=>{n.searchParams.set(a,c)}),n.toString()}function v(t,e,n){if(t.headers.get("S-Refresh")==="true")return location.reload(),Promise.resolve({status:t.status,html:null,event:null,targets:[]});let a=t.headers.get("S-Target")||n;return t.text().then(u=>{switch(t.headers.get("content-type")){case"text/html":return{status:t.status,html:u,event:null,targets:T(e,a)};case"text/plain":return{status:t.status,html:null,event:u,targets:[]};default:return{status:t.status,html:null,event:null,targets:[]}}})}function T(t,e){if(!e)return[t];let n=document.querySelectorAll(e);return Array.from(n)}function L(t,e,n){let c=new FormData(t);if(e.toUpperCase()==="GET"){let a=q(n);for(let[u,l]of c.entries())l instanceof File||a.searchParams.append(u,l.toString());return{url:a.toString(),body:null}}else return{url:n,body:c}}function q(t){return t.startsWith("http")?new URL(t):new URL(t,location.origin)}function x(t,e,n,c){let{url:a,body:u}=L(n,e,t),l={method:e};return u&&(l.body=u),fetch(a,l).then(p=>v(p,n,c))}function A(t,e,n,c){return n instanceof HTMLFormElement?x(t,e,n,c):fetch(t,{method:e}).then(a=>v(a,n,c))}function w(t,e){return e.event!==t.type?!1:e.selector?t.target.matches(e.selector):!0}function b(t){return t?t.split(/\s*\|\s*/).map(O).filter(Boolean):[]}function O(t){let e=t.split(/\s+/);return e.length===1?{event:e[0]}:e.length===3&&e[1]==="on"?{event:e[0],selector:e[2]}:(console.warn(`Invalid event spec: ${t}`),null)}(function(){let t;function e(r,s){let o=r.getAttribute(`s-${s}`);return o?{url:o,method:s}:null}function n(r,s,o){let i=e(r,"get")??e(r,"post")??e(r,"put")??e(r,"delete");if(!i)return;let{url:g,method:m}=i,f=r.getAttribute("s-target"),h=b(r.getAttribute("s-on"));for(let R of h)if(w(s,R)){c(g,m,r,f),s.preventDefault();break}if(!o)return;let y=r.parentElement;y&&n(y,s,!0)}function c(r,s,o,i){let g=E(o),m=S(r,g);A(m,s,o,i).then(f=>{f.html?f.targets.forEach(h=>{h.innerHTML=f.html,l(h)}):f.event&&d(f.event)}).catch(f=>{console.error("Request failed:",f)})}function a(r){for(let s of r)if(s.isIntersecting){let o=s.target,i=new CustomEvent("appear",{bubbles:!1,cancelable:!0});n(o,i,!1),t.unobserve(o)}}function u(){let r={root:null,threshold:0};t=new IntersectionObserver(a,r)}function l(r){let s=r.querySelectorAll("[s-on]");for(let o of s)b(o.getAttribute("s-on")).some(m=>m.event==="appear")&&t.observe(o)}function p(){let r=["click","change","input","submit"];for(let s of r)document.body.addEventListener(s,o=>{n(o.target,o,!0)},{capture:!0})}function d(r){let s=document.querySelectorAll(`[s-on*="${r}"]`);for(let o of s){let i=new CustomEvent(r,{bubbles:!1,cancelable:!0});n(o,i,!1)}}function P(){let r=document.body.getAttribute("s-ws");if(!r)return;let s=new WebSocket(r);s.onmessage=o=>{let i=o.data.toString();d(i)},s.onerror=o=>{console.error("WebSocket error:",o)},s.onclose=()=>{console.log("WebSocket connection closed")}}document.addEventListener("DOMContentLoaded",()=>{u(),p(),P(),l(document.body)})})();
