function E(e){let t=new URLSearchParams,n=e,c=[];for(;n;)c.unshift(n),n=n.parentElement;for(let a of c){let u=a.getAttribute("s-query");u&&new URLSearchParams(u).forEach((p,d)=>t.set(d,p))}return t}function S(e,t){if(t.toString()==="")return e;let n=new URL(e,location.origin);return t.forEach((c,a)=>{n.searchParams.set(a,c)}),n.toString()}function v(e,t,n){if(e.headers.get("S-Refresh")==="true")return location.reload(),Promise.resolve({status:e.status,html:null,event:null,targets:[]});let a=e.headers.get("S-Target")||n;return e.text().then(u=>{switch(e.headers.get("content-type")){case"text/html":return{status:e.status,html:u,event:null,targets:R(t,a)};case"text/plain":return{status:e.status,html:null,event:u,targets:[]};default:return{status:e.status,html:null,event:null,targets:[]}}})}function R(e,t){if(!t)return[e];let n=document.querySelectorAll(t);return Array.from(n)}function q(e,t,n){let c=new FormData(e);if(t.toUpperCase()==="GET"){let a=new URL(n);for(let[u,i]of c.entries())i instanceof File||a.searchParams.append(u,i.toString());return{url:a.toString(),body:null}}else return{url:n,body:c}}function x(e,t,n,c){let{url:a,body:u}=q(n,t,e),i={method:t};return u&&(i.body=u),fetch(a,i).then(p=>v(p,n,c))}function A(e,t,n,c){return n instanceof HTMLFormElement?x(e,t,n,c):fetch(e,{method:t}).then(a=>v(a,n,c))}function w(e,t){return t.event!==e.type?!1:t.selector?e.target.matches(t.selector):!0}function b(e){return e?e.split(/\s*\|\s*/).map(L).filter(Boolean):[]}function L(e){let t=e.split(/\s+/);return t.length===1?{event:t[0]}:t.length===3&&t[1]==="on"?{event:t[0],selector:t[2]}:(console.warn(`Invalid event spec: ${e}`),null)}(function(){let e;function t(r,s){let o=r.getAttribute(`s-${s}`);return o?{url:o,method:s}:null}function n(r,s,o){let l=t(r,"get")??t(r,"post")??t(r,"put")??t(r,"delete");if(!l)return;let{url:g,method:m}=l,f=r.getAttribute("s-target"),h=b(r.getAttribute("s-on"));for(let T of h)if(w(s,T)){c(g,m,r,f),s.preventDefault();break}if(!o)return;let y=r.parentElement;y&&n(y,s,!0)}function c(r,s,o,l){let g=E(o),m=S(r,g);A(m,s,o,l).then(f=>{f.html?f.targets.forEach(h=>{h.innerHTML=f.html,i(h)}):f.event&&d(f.event)}).catch(f=>{console.error("Request failed:",f)})}function a(r){for(let s of r)if(s.isIntersecting){let o=s.target,l=new CustomEvent("appear",{bubbles:!1,cancelable:!0});n(o,l,!1),e.unobserve(o)}}function u(){let r={root:null,threshold:0};e=new IntersectionObserver(a,r)}function i(r){let s=r.querySelectorAll("[s-on]");for(let o of s)b(o.getAttribute("s-on")).some(m=>m.event==="appear")&&e.observe(o)}function p(){let r=["click","change","input","submit"];for(let s of r)document.body.addEventListener(s,o=>{n(o.target,o,!0)},{capture:!0})}function d(r){let s=document.querySelectorAll(`[s-on*="${r}"]`);for(let o of s){let l=new CustomEvent(r,{bubbles:!1,cancelable:!0});n(o,l,!1)}}function P(){let r=document.body.getAttribute("s-ws");if(!r)return;let s=new WebSocket(r);s.onmessage=o=>{let l=o.data.toString();d(l)},s.onerror=o=>{console.error("WebSocket error:",o)},s.onclose=()=>{console.log("WebSocket connection closed")}}document.addEventListener("DOMContentLoaded",()=>{u(),p(),P(),i(document.body)})})();
