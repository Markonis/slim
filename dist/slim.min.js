function y(e){let t=new URLSearchParams,n=e,a=[];for(;n;)a.unshift(n),n=n.parentElement;for(let c of a){let u=c.getAttribute("s-query");u&&new URLSearchParams(u).forEach((m,g)=>t.set(g,m))}return t}function E(e,t){if(t.toString()==="")return e;let n=new URL(e,location.origin);return t.forEach((a,c)=>{n.searchParams.set(c,a)}),n.toString()}function v(e,t,n){if(e.headers.get("S-Refresh")==="true")return location.reload(),Promise.resolve({status:e.status,html:null,event:null,targets:[]});let c=e.headers.get("S-Target")||n;return e.text().then(u=>{switch(e.headers.get("content-type")?.split(";")[0]){case"text/html":return{status:e.status,html:u,event:null,targets:P(t,c)};case"text/plain":return{status:e.status,html:null,event:u,targets:[]};default:return{status:e.status,html:null,event:null,targets:[]}}})}function P(e,t){if(!t)return[e];let n=document.querySelectorAll(t);return Array.from(n)}function R(e,t,n){let a=new FormData(e);if(t.toUpperCase()==="GET"){let c=L(n);for(let[u,l]of a.entries())l instanceof File||c.searchParams.append(u,l.toString());return{url:c.toString(),body:null}}else return{url:n,body:a}}function L(e){return e.startsWith("http")?new URL(e):new URL(e,location.origin)}function q(e,t,n,a){let{url:c,body:u}=R(n,t,e),l={method:t};return u&&(l.body=u),fetch(c,l).then(m=>v(m,n,a))}function S(e,t,n,a){return n instanceof HTMLFormElement?q(e,t,n,a):fetch(e,{method:t}).then(c=>v(c,n,a))}function A(e,t){return t.event!==e.type?!1:t.selector?e.target.matches(t.selector):!0}function b(e){return e?e.split(/\s*\|\s*/).map(x).filter(Boolean):[]}function x(e){let t=e.split(/\s+/);return t.length===1?{event:t[0]}:t.length===3&&t[1]==="on"?{event:t[0],selector:t[2]}:(console.warn(`Invalid event spec: ${e}`),null)}(function(){let e;function t(r,s){let o=r.getAttribute(`s-${s}`);return o?{url:o,method:s}:null}function n(r,s,o){let i=t(r,"get")??t(r,"post")??t(r,"put")??t(r,"delete");if(i){let{url:p,method:d}=i,f=r.getAttribute("s-target"),h=b(r.getAttribute("s-on"));for(let T of h)if(A(s,T)){a(p,d,r,f),s.preventDefault();break}}else{if(!o)return;let p=r.parentElement;p&&n(p,s,!0)}}function a(r,s,o,i){let p=y(o),d=E(r,p);S(d,s,o,i).then(f=>{f.html?f.targets.forEach(h=>{h.innerHTML=f.html,l(h)}):f.event&&g(f.event)}).catch(f=>{console.error("Request failed:",f)})}function c(r){for(let s of r)if(s.isIntersecting){let o=s.target,i=new CustomEvent("appear",{bubbles:!1,cancelable:!0});n(o,i,!1),e.unobserve(o)}}function u(){let r={root:null,threshold:0};e=new IntersectionObserver(c,r)}function l(r){let s=r.querySelectorAll("[s-on]");for(let o of s)b(o.getAttribute("s-on")).some(d=>d.event==="appear")&&e.observe(o)}function m(){let r=["click","change","input","submit"];for(let s of r)document.body.addEventListener(s,o=>{n(o.target,o,!0)},{capture:!0})}function g(r){let s=document.querySelectorAll(`[s-on*="${r}"]`);for(let o of s){let i=new CustomEvent(r,{bubbles:!1,cancelable:!0});n(o,i,!1)}}function w(){let r=document.body.getAttribute("s-ws");if(!r)return;let s=new WebSocket(r);s.onmessage=o=>{let i=o.data.toString();g(i)},s.onerror=o=>{console.error("WebSocket error:",o)},s.onclose=()=>{console.log("WebSocket connection closed")}}document.addEventListener("DOMContentLoaded",()=>{u(),m(),w(),l(document.body)})})();
