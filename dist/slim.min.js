function x(t){let e=new URLSearchParams,n=t,s=[];for(;n;)s.unshift(n),n=n.parentElement;for(let c of s){let p=c.getAttribute("s-query");p&&new URLSearchParams(p).forEach((h,y)=>e.set(y,h))}if(t instanceof HTMLFormElement)return e;let a=Array.from(t.querySelectorAll("input, select, textarea")).reverse();for(let c of a){let p=c.getAttribute("name")??c.id;!p||!w(c)||e.set(p,c.value)}let i=t.getAttribute("name")??t.id;if(i){let c=w(t);c&&e.set(i,c)}return e}function w(t){return"value"in t?t.value:""}function P(t,e){if(e.toString()==="")return t;let n=new URL(t,location.origin);return e.forEach((s,a)=>{n.searchParams.set(a,s)}),n.toString()}function S(t,e,n){if(t.headers.get("S-Refresh")==="true")return location.reload(),Promise.resolve({status:t.status,html:null,text:null,event:null,targets:[]});if(!t.ok)return Promise.reject();let a=t.headers.get("S-Target")||n,i=t.headers.get("S-Emit");return t.text().then(c=>{let E=t.headers.get("content-type")?.split(";")[0],h=k(e,a);switch(E){case"text/html":return{status:t.status,html:c,text:null,event:i,targets:h};case"text/plain":return{status:t.status,html:null,text:c,event:i,targets:h};default:return{status:t.status,html:null,text:null,event:i,targets:[]}}})}function k(t,e){if(!e)return[t];let n=document.querySelectorAll(e);return Array.from(n)}function q(t,e,n){let s=new FormData(t);if(e.toUpperCase()==="GET"){let a=H(n);for(let[i,c]of s.entries())c instanceof File||a.searchParams.append(i,c.toString());return{url:a.toString(),body:null}}else return{url:n,body:s}}function H(t){return t.startsWith("http")?new URL(t):new URL(t,location.origin)}function U(t,e,n,s){let{url:a,body:i}=q(n,e,t),c={method:e};return i&&(c.body=i),fetch(a,c).then(p=>S(p,n,s))}function L(t,e,n,s){let a=s.getAttribute("s-target");if(s instanceof HTMLFormElement)return U(e,n,s,a);{let i={},c;if(t instanceof DragEvent){let p=t.dataTransfer?.getData("application/json");p&&(i["Content-Type"]="application/json",c=p)}return fetch(e,{method:n,headers:i,body:c}).then(p=>S(p,s,a))}}function A(t){let e=t.getAttribute("s-on");return e?e.split(/\s*\|\s*/).map(O).filter(Boolean):F(t)}function F(t){switch(t.tagName){case"FORM":return[{event:"submit"}];case"BUTTON":return[{event:"click"}];case"SELECT":case"INPUT":return[{event:"change"}];default:return[{event:"appear"}]}}function O(t){let e=t.split(/\s+on\s+/);return e.length===1?{event:e[0]}:e.length===2?{event:e[0],selector:e[1]}:(console.warn(`Invalid event spec: ${t}`),null)}function R(t,e){if(!(e instanceof DragEvent)||!e.dataTransfer)return;if(e.type==="dragstart"){let a=t.getAttribute("s-drag-json"),i=t.getAttribute("s-drag-effect");a&&e.dataTransfer.setData("application/json",a),i&&(e.dataTransfer.effectAllowed=i)}let n=t.getAttribute("s-drop-class"),s=t.getAttribute("s-drop-effect");if(e.type==="dragover"){if(!s)return;e.preventDefault(),e.dataTransfer.dropEffect,n&&t.classList.add(n)}else e.type==="dragleave"&&n&&t.classList.remove(n)}function C(t){let e=t.getAttribute("s-emit");if(!e)return null;let n=e.split(/\s+after\s/);if(n.length===2){let s=n[0],a=parseFloat(n[1]);return!s||isNaN(a)?null:(n[1].endsWith("s")&&(a*=1e3),a=Math.round(a),{event:s,delay:a})}else return{event:n[0],delay:0}}(function(){let t;function e(o,r){let u=o.getAttribute(`s-${r}`);return u?{url:u,method:r}:null}function n(o=document.body){return o.querySelectorAll("[s-get],[s-post],[s-put],[s-delete],[s-emit]")}function s(o){let r=o instanceof Event?o:new CustomEvent(o),u=n(),g=[],m=[];for(let f of u){let v=C(f),l=a(f);if(!v&&!l)continue;let d=A(f);for(let b of d)b.event===r.type&&(b.selector?g.push({event:r,element:f,emit:v,config:l,spec:b}):m.push({event:r,element:f,emit:v,config:l,spec:b}))}if(r.target&&r.target instanceof Element){let f=r.target;for(R(f,r);f;){let v=m.find(d=>d.element.isSameNode(f));v&&i(v);let l=g.filter(d=>f.matches(d.spec.selector));for(let d of l)i(d);if(r.type==="appear")break;if(f.parentElement)f=f.parentElement;else break}}else for(let f of[...g,...m])f.spec.event===r.type&&i(f)}function a(o){return e(o,"get")??e(o,"post")??e(o,"put")??e(o,"delete")}function i({event:o,element:r,config:u,emit:g}){let m=r.getAttribute("s-confirm");if(!(m&&!confirm(m))&&(g&&c(r,g),u)){let f=x(r),v=P(u.url,f);L(o,v,u.method,r).then(l=>{if(l.html!==null)for(let d of l.targets)d.innerHTML=l.html,h(d);else if(l.text!==null)for(let d of l.targets)d.textContent=l.text;else l.event&&s(l.event);r.dispatchEvent(new CustomEvent("slim:ok"))}).catch(l=>{console.error("Request failed:",l),r.dispatchEvent(new CustomEvent("slim:error"))}).finally(()=>{r.dispatchEvent(new CustomEvent("slim:done"))})}}function c(o,r){r.delay?setTimeout(()=>{o.parentElement&&s(r.event)},r.delay):s(r.event)}function p(o){for(let r of o)if(r.isIntersecting){let u=r.target;u.dispatchEvent(new CustomEvent("appear",{bubbles:!1})),t.unobserve(u)}}function E(){let o={root:null,threshold:0};t=new IntersectionObserver(p,o)}function h(o){let r=n(o);for(let u of r)A(u).some(f=>f.event==="appear")&&t.observe(u)}function y(){let o=["click","change","input","submit","appear","dragstart","dragover","dragleave","drop"];for(let r of o)document.body.addEventListener(r,u=>{u.type==="submit"&&u.preventDefault(),s(u)},{capture:!0})}function D(o){let r=document.body.getAttribute("s-ws");if(!r)return;let u=new WebSocket(r);u.onmessage=g=>{let m=g.data.toString();s(m)},u.onerror=g=>{console.warn("WebSocket error:",g),o()}}function T(){D(()=>{setTimeout(()=>T(),1e3)})}document.addEventListener("DOMContentLoaded",()=>{E(),y(),T(),h(document.body)})})();
