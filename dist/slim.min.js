function E(t){let e=new URLSearchParams,n=t,a=[];for(;n;)a.unshift(n),n=n.parentElement;for(let c of a){let u=c.getAttribute("s-query");u&&new URLSearchParams(u).forEach((p,d)=>e.set(d,p))}return e}function S(t,e){if(e.toString()==="")return t;let n=new URL(t,location.origin);return e.forEach((a,c)=>{n.searchParams.set(c,a)}),n.toString()}function v(t,e,n){if(t.headers.get("S-Refresh")==="true")return location.reload(),Promise.resolve({status:t.status,html:null,event:null,targets:[]});let c=t.headers.get("S-Target")||n;return t.text().then(u=>{switch(t.headers.get("content-type")?.split(";")[0]){case"text/html":return{status:t.status,html:u,event:null,targets:R(e,c)};case"text/plain":return{status:t.status,html:null,event:u,targets:[]};default:return{status:t.status,html:null,event:null,targets:[]}}})}function R(t,e){if(!e)return[t];let n=document.querySelectorAll(e);return Array.from(n)}function L(t,e,n){let a=new FormData(t);if(e.toUpperCase()==="GET"){let c=q(n);for(let[u,l]of a.entries())l instanceof File||c.searchParams.append(u,l.toString());return{url:c.toString(),body:null}}else return{url:n,body:a}}function q(t){return t.startsWith("http")?new URL(t):new URL(t,location.origin)}function x(t,e,n,a){let{url:c,body:u}=L(n,e,t),l={method:e};return u&&(l.body=u),fetch(c,l).then(p=>v(p,n,a))}function A(t,e,n,a){return n instanceof HTMLFormElement?x(t,e,n,a):fetch(t,{method:e}).then(c=>v(c,n,a))}function w(t,e){return e.event!==t.type?!1:e.selector?t.target.matches(e.selector):!0}function b(t){return t?t.split(/\s*\|\s*/).map(O).filter(Boolean):[]}function O(t){let e=t.split(/\s+/);return e.length===1?{event:e[0]}:e.length===3&&e[1]==="on"?{event:e[0],selector:e[2]}:(console.warn(`Invalid event spec: ${t}`),null)}(function(){let t;function e(r,s){let o=r.getAttribute(`s-${s}`);return o?{url:o,method:s}:null}function n(r,s,o){let i=e(r,"get")??e(r,"post")??e(r,"put")??e(r,"delete");if(!i)return;let{url:g,method:m}=i,f=r.getAttribute("s-target"),h=b(r.getAttribute("s-on"));for(let P of h)if(w(s,P)){a(g,m,r,f),s.preventDefault();break}if(!o)return;let y=r.parentElement;y&&n(y,s,!0)}function a(r,s,o,i){let g=E(o),m=S(r,g);A(m,s,o,i).then(f=>{f.html?f.targets.forEach(h=>{h.innerHTML=f.html,l(h)}):f.event&&d(f.event)}).catch(f=>{console.error("Request failed:",f)})}function c(r){for(let s of r)if(s.isIntersecting){let o=s.target,i=new CustomEvent("appear",{bubbles:!1,cancelable:!0});n(o,i,!1),t.unobserve(o)}}function u(){let r={root:null,threshold:0};t=new IntersectionObserver(c,r)}function l(r){let s=r.querySelectorAll("[s-on]");for(let o of s)b(o.getAttribute("s-on")).some(m=>m.event==="appear")&&t.observe(o)}function p(){let r=["click","change","input","submit"];for(let s of r)document.body.addEventListener(s,o=>{n(o.target,o,!0)},{capture:!0})}function d(r){let s=document.querySelectorAll(`[s-on*="${r}"]`);for(let o of s){let i=new CustomEvent(r,{bubbles:!1,cancelable:!0});n(o,i,!1)}}function T(){let r=document.body.getAttribute("s-ws");if(!r)return;let s=new WebSocket(r);s.onmessage=o=>{let i=o.data.toString();d(i)},s.onerror=o=>{console.error("WebSocket error:",o)},s.onclose=()=>{console.log("WebSocket connection closed")}}document.addEventListener("DOMContentLoaded",()=>{u(),p(),T(),l(document.body)})})();
